<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE node PUBLIC "-//freedesktop//DTD D-BUS Object Introspection 1.0//EN"
 "http://www.freedesktop.org/standards/dbus/1.0/introspect.dtd">
<node>
  <!--
    io.github.olafkfreund.CosmicExtPhoneAuth:
    @short_description: Phone-based biometric authentication interface

    This interface provides methods for requesting biometric authentication
    from paired mobile devices running the COSMIC Connect companion app.
    Authentication requests can use fingerprint, face recognition, or other
    device-supported biometric methods.
  -->
  <interface name="io.github.olafkfreund.CosmicExtPhoneAuth">
    <!--
      RequestAuth:
      @username: The username requesting authentication
      @auth_type: The authentication type (e.g., "sudo", "login", "unlock")
      @request_id: Unique identifier for tracking this auth request

      Initiates a new authentication request that will be sent to paired devices.
      Returns immediately with a request_id that can be used to check status.
      The request will timeout after DefaultTimeout seconds if not approved.
    -->
    <method name="RequestAuth">
      <arg name="username" type="s" direction="in"/>
      <arg name="auth_type" type="s" direction="in"/>
      <arg name="request_id" type="s" direction="out"/>
    </method>

    <!--
      CheckAuth:
      @request_id: The request identifier from RequestAuth
      @approved: Whether the authentication was approved
      @biometric_type: The biometric method used (e.g., "fingerprint", "face", "none")

      Checks the current status of an authentication request.
      Returns immediately with the current state.
    -->
    <method name="CheckAuth">
      <arg name="request_id" type="s" direction="in"/>
      <arg name="approved" type="b" direction="out"/>
      <arg name="biometric_type" type="s" direction="out"/>
    </method>

    <!--
      CancelAuth:
      @request_id: The request identifier to cancel
      @success: Whether the cancellation was successful

      Cancels a pending authentication request.
      Returns false if the request doesn't exist or is already completed.
    -->
    <method name="CancelAuth">
      <arg name="request_id" type="s" direction="in"/>
      <arg name="success" type="b" direction="out"/>
    </method>

    <!--
      GetPendingRequests:
      @requests: Array of pending request tuples

      Administrative method to list all pending authentication requests.
      Each tuple contains: (request_id, username, auth_type, timestamp, device_count)
      Requires Polkit authorization for admin actions.

      Array structure: a(ssstt)
        - s: request_id
        - s: username
        - s: auth_type
        - t: timestamp (UNIX time in seconds)
        - t: device_count (number of devices sent to)
    -->
    <method name="GetPendingRequests">
      <arg name="requests" type="a(ssstt)" direction="out"/>
      <annotation name="org.freedesktop.DBus.Method.Polkit" value="io.github.olafkfreund.CosmicExtPhoneAuth.admin"/>
    </method>

    <!--
      AuthCompleted:
      @request_id: The request identifier
      @approved: Whether authentication was approved
      @biometric_type: The biometric method used

      Signal emitted when an authentication request is completed.
      PAM modules should listen for this signal to unblock authentication.
    -->
    <signal name="AuthCompleted">
      <arg name="request_id" type="s"/>
      <arg name="approved" type="b"/>
      <arg name="biometric_type" type="s"/>
    </signal>

    <!--
      AuthTimeout:
      @request_id: The request identifier that timed out

      Signal emitted when an authentication request times out without response.
      This is considered an authentication failure.
    -->
    <signal name="AuthTimeout">
      <arg name="request_id" type="s"/>
    </signal>

    <!--
      DefaultTimeout:

      The default timeout in seconds for authentication requests.
      After this period, unanswered requests will timeout and emit AuthTimeout.
      Default: 30 seconds
    -->
    <property name="DefaultTimeout" type="t" access="read">
      <annotation name="org.freedesktop.DBus.Property.EmitsChangedSignal" value="true"/>
    </property>

    <!--
      ConnectedDevices:

      The number of currently connected devices capable of handling auth requests.
      If this is 0, RequestAuth will fail immediately.
    -->
    <property name="ConnectedDevices" type="u" access="read">
      <annotation name="org.freedesktop.DBus.Property.EmitsChangedSignal" value="true"/>
    </property>
  </interface>
</node>
